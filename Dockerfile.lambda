FROM public.ecr.aws/lambda/python:latest as base

# Install poetry
RUN curl -sSL https://install.python-poetry.org | python3 -
ENV PATH="/root/.local/bin:${PATH}"

ADD . .

RUN poetry build
RUN poetry run pip install --upgrade -t package dist/*.whl

COPY ./package ${LAMBDA_TASK_ROOT}

# Entrypoint
CMD ['modelled_needs.index.LambdaHandler']
